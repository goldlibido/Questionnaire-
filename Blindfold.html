<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Blindfold Mode â€” Chat Now</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:Montserrat;background:#0d0d0d;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
  button{padding:14px 28px;font-size:18px;font-weight:600;border:none;border-radius:12px;cursor:pointer;
    background:#e1bf78;color:#000;box-shadow:0 6px 18px rgba(0,0,0,.4)}
  button:hover{transform:translateY(-1px)}
  audio{margin-top:20px;width:90%;max-width:400px}
</style>
</head>
<body>
  <button id="chatBtn">Chat Now</button>
  <audio id="remote" autoplay controls></audio>

<script>
let pc, localStream;
const btn = document.getElementById('chatBtn');
const remoteAudio = document.getElementById('remote');

async function chatNow(){
  btn.disabled = true;
  localStream = await navigator.mediaDevices.getUserMedia({audio:true});
  pc = new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  pc.addTrack(localStream.getTracks()[0], localStream);
  pc.ontrack = e => remoteAudio.srcObject = e.streams[0];

  // If you are the first user: create offer and prompt them to share
  if(!sessionStorage.getItem("hasOffer")){
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    await new Promise(r=>setTimeout(r,1500));
    const sdp = btoa(JSON.stringify(pc.localDescription));
    const theirAnswer = prompt("Send this Offer to your partner, then paste their Answer here:", sdp);
    if(theirAnswer){
      const ans = JSON.parse(atob(theirAnswer));
      await pc.setRemoteDescription(ans);
    }
    sessionStorage.setItem("hasOffer","1");
  } else {
    // Second user: paste partner's offer, generate answer
    const theirOffer = prompt("Paste your partner's Offer here:");
    const offer = JSON.parse(atob(theirOffer));
    await pc.setRemoteDescription(offer);
    const ans = await pc.createAnswer();
    await pc.setLocalDescription(ans);
    await new Promise(r=>setTimeout(r,1500));
    alert("Send this Answer back to your partner:\n\n"+ btoa(JSON.stringify(pc.localDescription)));
  }
}
btn.onclick = chatNow;
</script>
</body>
</html>