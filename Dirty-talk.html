<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dirty Talk ‚Äî Rate Your Rizz</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--gold:#e1bf78;--green:#06954E;--blue:#064D95;--red:#ff1e2d;}
  *{box-sizing:border-box}
  body{
    margin:0;background:#000;color:#fff;font-family:'Montserrat',sans-serif;
    display:flex;align-items:center;justify-content:center;min-height:100vh;padding:10px;
  }
  .wrap{width:100%;max-width:950px}
  .panel{
    border:2px solid var(--gold);border-radius:14px;background:#0b0b0b;
    box-shadow:0 0 22px rgba(225,191,120,.5);padding:12px;
  }

  /* Stage: your big image */
  .stage{position:relative;width:100%;overflow:hidden;border-radius:12px}
  .stage img{width:100%;display:block;height:auto;border-radius:12px;user-select:none;-webkit-user-drag:none}
  .overlay{position:absolute;inset:0;pointer-events:none}

  /* Heart overlay using your exact PNG */
  .heart{
    position:absolute;width:66px;height:66px;transform:translate(-50%,-50%) scale(1);
    background:url('heart.png') center/contain no-repeat;opacity:0;will-change:transform,opacity;
    filter: drop-shadow(0 0 8px rgba(255,30,45,.6));
  }
  .heart.in{
    animation:heartMove 900ms cubic-bezier(.2,.9,.2,1) forwards;
  }
  @keyframes heartMove{
    0%{opacity:0;transform:translate(-50%,-50%) scale(.2)}
    40%{opacity:1}
    100%{opacity:1;transform:translate(var(--tx), var(--ty)) scale(1)}
  }

  .controls{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
  input[type="text"]{
    flex:1;min-width:200px;padding:12px;border:1px solid var(--gold);border-radius:10px;
    background:#1b1b1b;color:#fff;
  }
  button{
    border:none;border-radius:22px;color:#fff;cursor:pointer;font-size:1rem;
    padding:12px 16px;background:#333;transition:transform .15s, box-shadow .15s
  }
  button:hover{transform:scale(1.05);box-shadow:0 0 10px currentColor}
  #submit-btn{background:var(--green)}
  #voice-btn{background:var(--blue)}
  #try-again-btn{background:#c40018}
  #mute-btn{background:#4a4a4a}
  #result{min-height:1.6em;text-align:center;margin-top:8px;color:var(--gold)}
  .hint{opacity:.9;font-size:.9rem;text-align:center;margin-top:6px}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <!-- Big background image (replace filename if needed) -->
      <div class="stage" id="stage">
        <img id="bg" src="dirty-talk-stage.png" alt="Dirty Talk Stage">
        <div id="overlay" class="overlay" aria-hidden="true"></div>
      </div>

      <div class="controls">
        <input id="line" type="text" placeholder="Type or dictate your pick-up line‚Ä¶" />
        <button id="voice-btn" title="Speak your line">üéôÔ∏è Speak</button>
        <button id="submit-btn">Submit</button>
        <button id="try-again-btn" class="hidden">Try Again</button>
        <button id="mute-btn" title="Toggle music/sfx">üîà Mute</button>
      </div>

      <div id="result"></div>
      <div class="hint">Higher score ‚áí the heart lands closer to center (bull‚Äôs-eye).</div>
    </div>
  </div>

<script>
/* ------------------ Helpers ------------------ */
const $ = s => document.querySelector(s);
const overlay = $('#overlay');
const result  = $('#result');

function clamp(n,min,max){ return Math.min(max,Math.max(min,n)); }

/* ------------------ Speech to Text ------------------ */
let recognition = null;
function ensureSpeech(){
  if (recognition) return recognition;
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR){
    alert('Speech recognition not supported in this browser. Please type your line.');
    return null;
  }
  const rec = new SR();
  rec.continuous = false;
  rec.interimResults = false;
  rec.lang = 'en-US';
  rec.onresult = (e)=>{
    const t = e.results[0][0].transcript || '';
    $('#line').value = t;
    onSubmit();
  };
  rec.onerror = (e)=> {
    console.warn('Speech error:', e?.error);
    result.textContent = 'Voice error ‚Äî try typing your line!';
  };
  recognition = rec;
  return rec;
}

/* ------------------ Scoring logic (client-side ‚ÄúAI‚Äù) ------------------ */
function scoreLine(line){
  if (!line.trim()) return {score:0, feedback:'Say something first üòÖ'};
  const txt = line.toLowerCase();

  const positive = ['love','beautiful','eyes','heart','smile','cute','amazing','perfect','gorgeous','stunning','date','drink','you','your'];
  const cheesy   = ['heaven','angel','google','maps','mirror','library','wifi','phone number','pickup','pick-up'];
  const cringe   = ['ur','babe','bb','sex','naughty','nsfw'];

  let score = 0;
  // useful length 8‚Äì140 chars ‚Üí up to 45 pts
  score += clamp((txt.length - 8) * 1.0, 0, 45);
  // positive words ‚Üí up to 35 pts
  score += clamp(positive.filter(w=>txt.includes(w)).length * 8, 0, 35);
  // uniqueness ‚Üí up to 15 pts
  const uniq = new Set(txt.split(/\W+/).filter(Boolean));
  score += clamp((uniq.size - 4) * 1.5, 0, 15);
  // penalties
  score -= clamp(cheesy.filter(w=>txt.includes(w)).length * 5, 0, 10);
  score -= clamp(cringe.filter(w=>txt.includes(w)).length * 12.5, 0, 25);

  score = clamp(Math.round(score), 0, 100);

  let feedback = 'Work on your rizz! üòÖ';
  if (score >= 85) feedback = 'Perfect rizz! üî•';
  else if (score >= 70) feedback = 'Solid line! üòé';
  else if (score >= 50) feedback = 'Nice try! üòâ';

  return {score, feedback};
}

/* ------------------ Heart animation ------------------ */
function animateHeart(score){
  overlay.innerHTML = '';
  const mover = document.createElement('div');
  mover.className = 'heart in';
  overlay.appendChild(mover);

  // center of overlay; distance based on score
  const rect = overlay.getBoundingClientRect();
  const maxD = Math.min(rect.width, rect.height) * 0.40;  // max radius
  const dist = maxD * (1 - score/100);                    // higher score ‚Üí closer
  const ang  = Math.random() * Math.PI * 2;
  const dx   = Math.cos(ang) * dist;
  const dy   = Math.sin(ang) * dist;

  mover.style.setProperty('--tx', `calc(-50% + ${dx}px)`);
  mover.style.setProperty('--ty', `calc(-50% + ${dy}px)`);
}

/* ------------------ Audio: music + SFX (Web Audio) ------------------ */
let AC = null, masterGain = null, isMuted = false;
function ensureAudio(){
  if (AC) return AC;
  AC = new (window.AudioContext || window.webkitAudioContext)();
  masterGain = AC.createGain();
  masterGain.gain.value = 0.35; // overall volume
  masterGain.connect(AC.destination);
  startPad(); // background pad
  return AC;
}

function startPad(){
  // gentle triad pad using three detuned oscillators
  const base = 220; // A3
  [0, 4, 7].forEach((semi, i)=>{
    const o = AC.createOscillator();
    const g = AC.createGain();
    o.type = 'sine';
    o.frequency.value = base * Math.pow(2, semi/12);
    g.gain.value = 0.0001;
    o.connect(g).connect(masterGain);
    o.start();

    // fade in/out loop
    const t = AC.currentTime + i * 0.25;
    g.gain.linearRampToValueAtTime(0.12, t + 1.5);
    g.gain.linearRampToValueAtTime(0.05, t + 5.0);
    // keep gently modulating
    const LFO = AC.createOscillator();
    const LG  = AC.createGain();
    LFO.type='sine'; LFO.frequency.value = 0.05 + i*0.02;
    LG.gain.value = 0.03;
    LFO.connect(LG).connect(g.gain);
    LFO.start();
  });
}

// score-based SFX
function playSfx(score){
  const t = AC.currentTime;
  const g = AC.createGain(); g.gain.value = 0.0; g.connect(masterGain);

  if (score >= 80){
    // pleasant chime (two sine blips)
    const o1 = AC.createOscillator(); o1.type='sine'; o1.frequency.setValueAtTime(880, t);
    const o2 = AC.createOscillator(); o2.type='sine'; o2.frequency.setValueAtTime(1320, t);
    o1.connect(g); o2.connect(g);
    g.gain.linearRampToValueAtTime(0.25, t+0.02);
    g.gain.exponentialRampToValueAtTime(0.001, t+0.6);
    o1.start(t); o2.start(t+0.03);
    o1.stop(t+0.7); o2.stop(t+0.7);
  } else if (score >= 50){
    // neutral tick
    const o = AC.createOscillator(); o.type='triangle'; o.frequency.setValueAtTime(520, t);
    o.connect(g);
    g.gain.linearRampToValueAtTime(0.18, t+0.02);
    g.gain.exponentialRampToValueAtTime(0.001, t+0.25);
    o.start(t); o.stop(t+0.3);
  } else {
    // soft thump
    const o = AC.createOscillator(); o.type='sine';
    const f = o.frequency; f.setValueAtTime(180, t); f.exponentialRampToValueAtTime(60, t+0.25);
    o.connect(g);
    g.gain.linearRampToValueAtTime(0.22, t+0.02);
    g.gain.exponentialRampToValueAtTime(0.001, t+0.28);
    o.start(t); o.stop(t+0.35);
  }
}

function toggleMute(){
  if (!AC){ ensureAudio(); }
  isMuted = !isMuted;
  masterGain.gain.value = isMuted ? 0 : 0.35;
  $('#mute-btn').textContent = isMuted ? 'üîá Unmute' : 'üîà Mute';
}

/* ------------------ Submit flow ------------------ */
function rateAndAnimate(line){
  const {score, feedback} = scoreLine(line);
  result.textContent = `Score: ${score}/100 ‚Äî ${feedback}`;
  animateHeart(score);
  if (!AC) ensureAudio();
  if (!isMuted) playSfx(score);
  $('#try-again-btn').classList.remove('hidden');
}

function onSubmit(){
  const line = $('#line').value.trim();
  if (!line){
    result.textContent = 'Enter or speak a pick-up line first!';
    return;
  }
  rateAndAnimate(line);
}

/* ------------------ Events ------------------ */
$('#submit-btn').addEventListener('click', onSubmit);

$('#voice-btn').addEventListener('click', ()=>{
  const rec = ensureSpeech();
  if (!rec) return;
  if (!AC) ensureAudio(); // user gesture ‚Äî unlock audio on iOS
  result.textContent = 'Listening‚Ä¶ say your line!';
  try { rec.start(); } catch { /* ignore if already running */ }
});

$('#try-again-btn').addEventListener('click', ()=>{
  $('#line').value = '';
  result.textContent = '';
  overlay.innerHTML = '';
  $('#try-again-btn').classList.add('hidden');
});

$('#mute-btn').addEventListener('click', toggleMute);

// keep overlay sized to the image box
function syncOverlay(){ overlay.style.width = $('#bg').clientWidth+'px'; overlay.style.height=$('#bg').clientHeight+'px'; }
window.addEventListener('load', syncOverlay);
window.addEventListener('resize', syncOverlay);
document.addEventListener('readystatechange', syncOverlay);

// Start audio engine on first click/touch anywhere (helps iOS)
window.addEventListener('pointerdown', ()=>{ if (!AC) ensureAudio(); }, {once:true});
</script>
</body>
</html>
