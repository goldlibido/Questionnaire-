<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Install Le Libido</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#064D95" />
  <link rel="apple-touch-icon" href="le-libido-icon.png" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --gold: #e1bf78;
      --red: #950606;
      --blue: #064D95;
      --green: #06954E;
      --white: #ffffff;
      --charcoal: #0d0d0d;
    }

    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: var(--charcoal);
      color: var(--white);
      padding: 0;
      border: 5px solid var(--gold);
      border-radius: 16px;
      text-align: center;
    }

    .container {
      padding: 40px 20px;
    }

    img.logo {
      max-width: 180px;
      margin-top: 20px;
    }

    .app-description {
      max-width: 700px;
      margin: 20px auto 30px auto;
      font-size: 1rem;
      line-height: 1.6;
    }

    .install-button {
      background-color: var(--red);
      color: var(--white);
      border: none;
      padding: 14px 28px;
      font-size: 1.2rem;
      border-radius: 8px;
      cursor: pointer;
      animation: pulse 2s infinite;
      margin-bottom: 40px;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.08); }
      100% { transform: scale(1); }
    }

    .how-it-works {
      background-color: var(--blue);
      border: 4px solid var(--green);
      border-radius: 12px;
      max-width: 800px;
      margin: 0 auto 60px;
      padding: 30px 20px;
      text-align: left;
    }

    .how-it-works h2 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 20px;
    }

    .how-it-works ol {
      padding-left: 20px;
      font-size: 1rem;
      line-height: 1.7;
    }

    .ios-instructions {
      background-color: var(--gold);
      color: black;
      font-size: 0.9rem;
      padding: 15px;
      margin-top: 30px;
      border-radius: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="le-libido-icon.png" alt="Le Libido App Icon" class="logo" />

    <div class="app-description">
      Le Libido is the dating app that only works when you‚Äôre out in the world. No ghosting. No swiping. Just instant IRL connection with real people, in real places, in real time.
    </div>

    <button class="install-button" id="installBtn">Install the App</button>

    <div class="how-it-works">
      <h2>üî• How It Works</h2>
      <ol>
        <li><strong>Take our hilariously sexy 10-question quiz</strong></li>
        <li><strong>Choose your mode: Verified or Anonymous</strong></li>
        <li><strong>Scope out the scene</strong></li>
        <li><strong>Make your move</strong></li>
        <li><strong>Slide into real life</strong></li>
      </ol>
    </div>

    <div id="iosInstructions" class="ios-instructions">
      Using Safari? Tap the <strong>Share</strong> icon and then <strong>"Add to Home Screen"</strong> to install Le Libido.
    </div>
  </div>

  <script>
    let deferredPrompt;

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('Service Worker registered'))
        .catch((err) => console.error('SW registration failed:', err));
    }

    // Show iOS instructions
    const isiOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    if (isiOS) {
      document.getElementById('iosInstructions').style.display = 'block';
    }

    // Handle beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      // Show install prompt immediately
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((result) => {
        console.log('Install result:', result.outcome);
        deferredPrompt = null;
      });
    });

    // Request location and push permissions
    async function requestPermissions() {
      // Location
      if ('geolocation' in navigator) {
        navigator.geolocation.getCurrentPosition(
          (pos) => console.log('Location allowed:', pos),
          (err) => console.error('Location denied:', err),
          { enableHighAccuracy: true }
        );
      }

      // Push Notifications
      if ('Notification' in window && Notification.permission !== 'granted') {
        try {
          const permission = await Notification.requestPermission();
          console.log('Push permission:', permission);
        } catch (err) {
          console.error('Push request error:', err);
        }
      }
    }

    // Trigger everything on page load
    window.addEventListener('load', () => {
      requestPermissions();
    });

    // Fallback: Red button still visible but now does nothing
    document.getElementById('installBtn').addEventListener('click', () => {
      alert('If you see an ‚ÄúAdd to Home Screen‚Äù option, tap it to install!');
    });
  </script>
</body>
</html>