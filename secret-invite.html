<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Le Libido – Secret Invite</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --gold:#e1bf78;
    --black:#000;
    --white:#fff;
    --blue:#064D95;
    --green:#06954E;
    --red:#950606;
    --modal-max:560px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--black);color:var(--white);
    font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif
  }
  .page-wrap{min-height:100svh;padding:24px;border:2px solid var(--gold);position:relative}

  /* Header with centered logo + gear */
  .header{display:flex;align-items:center;justify-content:center;position:relative;margin-bottom:16px}
  .logo{display:block;margin:0 auto;max-width:140px;width:140px;height:auto}
  .gear{position:absolute;right:0;top:0;width:40px;height:40px;border:1px solid var(--gold);border-radius:10px;display:grid;place-items:center;background:transparent;color:var(--gold);cursor:pointer}
  .gear svg{width:22px;height:22px}
  .menu{position:absolute;right:0;top:48px;background:#0f0f0f;border:1px solid var(--gold);border-radius:12px;display:none;min-width:220px;overflow:hidden;z-index:20}
  .menu.show{display:block}
  .menu a,.menu button{display:flex;align-items:center;gap:8px;width:100%;padding:12px 14px;background:transparent;border:none;color:var(--white);text-decoration:none;cursor:pointer;font-size:14px}
  .menu a:hover,.menu button:hover{background:#171717}

  /* Area controls (kept lightweight) */
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-bottom:10px}
  .areas{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
  .tag{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--gold);padding:8px 10px;border-radius:10px;cursor:pointer;user-select:none;font-size:14px}
  .tag input{accent-color:var(--gold)}
  .save-areas{border:1px solid var(--gold);background:transparent;color:var(--gold);padding:8px 12px;border-radius:10px;cursor:pointer}

  /* Doors */
  .doors{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:28px;align-items:end;max-width:1200px;margin:20px auto 0}
  .door{display:flex;flex-direction:column;align-items:center;gap:10px}
  .door-caption{font-size:16px;font-weight:700;margin:2px 0 6px 0;letter-spacing:.2px}
  .caption-blue{color:var(--blue)}
  .caption-green{color:var(--green)}
  .caption-red{color:var(--red)}

  /* Door button: bigger, no gray box, no border */
  .door-btn{
    display:block;width:100%;max-width:360px;aspect-ratio:3/5;
    background:transparent;border:none;border-radius:0;overflow:hidden;position:relative;cursor:pointer
  }
  .door-btn img{
    width:100%;height:100%;object-fit:contain;background:transparent;
    user-select:none;-webkit-user-drag:none;pointer-events:none
  }

  .door-label{font-size:14px;opacity:.9}
  .hint{font-size:13px;color:#bbb;text-align:center;margin-top:6px}

  /* Locked feedback */
  .shake{animation:shake .5s ease}
  @keyframes shake{
    10%,90%{transform:translateX(-1px)}
    20%,80%{transform:translateX(2px)}
    30%,50%,70%{transform:translateX(-4px)}
    40%,60%{transform:translateX(4px)}
  }

  /* Modal (universal) */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
  .modal-backdrop.show{display:flex}
  .modal{width:100%;max-width:var(--modal-max);background:#0f0f0f;border:2px solid var(--gold);border-radius:16px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.6)}
  .modal-head{padding:14px 18px;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between}
  .modal-title{margin:0;font-size:18px;font-weight:700;letter-spacing:.2px}
  .modal-close{background:transparent;border:none;color:var(--white);font-size:22px;cursor:pointer;line-height:1}
  .modal-body{padding:18px}
  .pill{display:inline-block;border:1px solid var(--gold);color:var(--gold);padding:6px 10px;border-radius:999px;font-size:12px;margin-bottom:10px}
  .invite-card{border:1px solid var(--gold);border-radius:12px;padding:16px;margin-top:10px;background:#111}
  .invite-brand{font-size:14px;opacity:.85;margin-bottom:8px}
  .invite-h1{margin:0 0 10px 0;font-size:22px;font-weight:700;line-height:1.25}
  .meta{display:grid;grid-template-columns:1fr;gap:8px;margin:12px 0}
  .meta div{font-size:14px;opacity:.95}
  .buttons{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .btn{border:1px solid var(--gold);background:transparent;color:var(--gold);padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
  .btn.primary{background:var(--gold);color:#111;border-color:var(--gold)}
  .btn:disabled{opacity:.4;cursor:not-allowed}
  .tiny{font-size:12px;opacity:.8;margin-top:6px}

  /* Dynamic color accents */
  .theme-red .modal-head{background:linear-gradient(0deg, rgba(149,6,6,.35), rgba(149,6,6,.35))}
  .theme-green .modal-head{background:linear-gradient(0deg, rgba(6,149,78,.35), rgba(6,149,78,.35))}
  .theme-blue .modal-head{background:linear-gradient(0deg, rgba(6,77,149,.35), rgba(6,77,149,.35))}
  .theme-red .invite-card{background:rgba(149,6,6,.12)}
  .theme-green .invite-card{background:rgba(6,149,78,.12)}
  .theme-blue .invite-card{background:rgba(6,77,149,.12)}

  .blurred{filter:blur(6px);user-select:none}
  @media (max-width:900px){ .doors{grid-template-columns:1fr;max-width:520px} }
</style>
</head>
<body>
<div class="page-wrap">
  <!-- Header with centered logo + gear -->
  <header class="header">
    <img class="logo" src="golden-le-libido-logo.png" alt="Le Libido" loading="lazy">
    <button class="gear" id="gearBtn" aria-label="Open menu" title="Menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 4.2 19.4l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09c-.65 0-1.24.39-1.51 1Z"/>
      </svg>
    </button>
    <nav class="menu" id="gearMenu" role="menu" aria-label="Settings">
      <button id="profileBtn" role="menuitem">Profile</button>
    </nav>
  </header>

  <!-- Area picker -->
  <div class="controls">
    <div class="areas" id="areas"></div>
    <button class="save-areas" id="saveAreasBtn">Save areas</button>
  </div>

  <!-- Doors -->
  <section class="doors">
    <!-- BLUE -->
    <div class="door" data-color="blue">
      <div class="door-caption caption-blue">For the Romantic</div>
      <button class="door-btn" id="door-blue" aria-label="Blue room door">
        <img id="door-blue-img" alt="Blue door" src="" />
      </button>
      <div class="door-label">Blue Room</div>
      <div class="hint">Click door to enter the Blue room</div>
    </div>

    <!-- GREEN -->
    <div class="door" data-color="green">
      <div class="door-caption caption-green">For the Frisky</div>
      <button class="door-btn" id="door-green" aria-label="Green room door">
        <img id="door-green-img" alt="Green door" src="" />
      </button>
      <div class="door-label">Green Room</div>
      <div class="hint">Click door to enter the Green room</div>
    </div>

    <!-- RED -->
    <div class="door" data-color="red">
      <div class="door-caption caption-red">For the Kinky</div>
      <button class="door-btn" id="door-red" aria-label="Red room door">
        <img id="door-red-img" alt="Red door" src="" />
      </button>
      <div class="door-label">Red Room</div>
      <div class="hint">Click door to enter the Red room</div>
    </div>
  </section>
</div>

<!-- Universal Modal -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" id="modal">
    <div class="modal-head">
      <h2 class="modal-title" id="modalTitle">Invitation</h2>
      <button class="modal-close" id="modalClose" aria-label="Close">×</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
/* ===========================
   Derive color from localStorage (supports slug or title)
=========================== */
const slugToTitle = {
  'devoted_darling':'Devoted Darling','mood_multiplier':'Mood Multiplier','tender_protector':'Tender Protector','heatwave':'Heatwave',
  'promiscuous_plaything':'Promiscuous Plaything','generous_giver':'Generous Giver','bedroom_adventurer':'Bedroom Adventurer','charmer_in_charge':'Charmer in Charge',
  'punish_me':'Punish Me','provoker':'Provoker','dungeon_master':'Dungeon Master','claimed_and_trained':'Claimed & Trained'
};
const roomMap = {
  'Tender Protector':'blue','Devoted Darling':'blue','Mood Multiplier':'blue','Heatwave':'blue',
  'Promiscuous Plaything':'green','Generous Giver':'green','Bedroom Adventurer':'green','Charmer in Charge':'green',
  'Dungeon Master':'red','Provoker':'red','Punish Me':'red','Claimed & Trained':'red'
};
function getArchetypeColor(){
  // 1) direct color
  const c=(localStorage.getItem("archetypeColor")||"").toLowerCase();
  if(['blue','green','red'].includes(c)) return c;
  // 2) from archetype slug or title
  const raw=localStorage.getItem('archetype')||'Mood Multiplier';
  const title=slugToTitle[raw]||raw;
  return roomMap[title]||'blue';
}

/* ===========================
   Minimal config for invite
=========================== */
const AREAS = [{ id:"central-nj", label:"Central New Jersey" }];
const VENUES_BY_AREA = {
  "central-nj":[
    { name:"Metropolitan Cafe", address:"8 E Main St, Freehold, NJ 07728", time:"7:30 PM", maps:"https://www.google.com/maps/search/?api=1&query=Metropolitan+Cafe+8+E+Main+St,+Freehold,+NJ+07728" },
    { name:"Nonna’s Cucina", address:"448 US-9, Englishtown, NJ 07726", time:"7:30 PM", maps:"https://www.google.com/maps/search/?api=1&query=Nonna%E2%80%99s+Cucina+448+US-9,+Englishtown,+NJ+07726" }
  ]
};
const THEMES = [
  "Heaven vs. Hell: Angel or Devil","Cats vs. Dogs","Brain vs. Brawn","Light vs. Dark","Burlesque & Cabaret",
  "Fetish Fantasy","Sexy Uniform","Slumber Party Gone Wild","Primal Instincts","Neon Nights","Mobster & Mob Wife",
  "Goth night","After Dark at the Office","Flasher","Vampires and Velvet"
];
const COLOR_CLASS = { blue:"theme-blue", green:"theme-green", red:"theme-red" };

/* ===========================
   Areas UI
=========================== */
const AREAS_KEY="lelibido:selectedAreas";
function getSelectedAreas(){
  try{ const raw=localStorage.getItem(AREAS_KEY); if(raw){ const a=JSON.parse(raw); if(Array.isArray(a)&&a.length) return a }}catch(e){}
  return ["central-nj"];
}
function setSelectedAreas(arr){ localStorage.setItem(AREAS_KEY, JSON.stringify(arr)) }

const areasEl=document.getElementById("areas");
const saveAreasBtn=document.getElementById("saveAreasBtn");
function renderAreas(){
  const selected=new Set(getSelectedAreas());
  areasEl.innerHTML="";
  AREAS.forEach(a=>{
    const id=`area-${a.id}`;
    const tag=document.createElement("label");
    tag.className="tag";
    tag.innerHTML=`<input type="checkbox" id="${id}" ${selected.has(a.id)?"checked":""}> ${a.label}`;
    areasEl.appendChild(tag);
  });
}
renderAreas();
saveAreasBtn.addEventListener("click", ()=>{
  const chosen=[];
  areasEl.querySelectorAll("input[type=checkbox]").forEach(cb=>{
    if(cb.checked) chosen.push(cb.id.replace("area-",""));
  });
  if(!chosen.length) chosen.push("central-nj");
  setSelectedAreas(chosen);
});

/* ===========================
   Door frames
=========================== */
const DOOR_FRAMES = {
  blue: Array.from({length:7},(_,i)=>`door/blue-door-${i+1}.png`),
  green: Array.from({length:7},(_,i)=>`door/green-door-${i+1}.png`),
  red: Array.from({length:7},(_,i)=>`door/red-door-${i+1}.png`)
};
const DOOR_CLOSED = {
  blue: DOOR_FRAMES.blue[0], green: DOOR_FRAMES.green[0], red: DOOR_FRAMES.red[0]
};
const doorImg={
  blue:document.getElementById("door-blue-img"),
  green:document.getElementById("door-green-img"),
  red:document.getElementById("door-red-img")
};
const doorBtn={
  blue:document.getElementById("door-blue"),
  green:document.getElementById("door-green"),
  red:document.getElementById("door-red")
};
doorImg.blue.src=DOOR_CLOSED.blue;
doorImg.green.src=DOOR_CLOSED.green;
doorImg.red.src=DOOR_CLOSED.red;

function preloadFrames(list){ list.forEach(src=>{ const i=new Image(); i.src=src; }); }
["blue","green","red"].forEach(c=>preloadFrames(DOOR_FRAMES[c]));

/* Smooth, immediate animation on first tap */
function playDoorAnimation(color){
  const frames=DOOR_FRAMES[color]; const img=doorImg[color];
  return new Promise(resolve=>{
    let i=0;
    const tick=()=>{
      img.src=frames[i]; i++;
      if(i<frames.length){ requestAnimationFrame(tick) } else { resolve() }
    };
    tick();
  });
}

function lockedEffect(el){ el.classList.remove("shake"); void el.offsetWidth; el.classList.add("shake"); if(navigator.vibrate){ try{ navigator.vibrate(80) }catch(e){} } }

/* ===========================
   Modal helpers
=========================== */
const modalBackdrop=document.getElementById("modalBackdrop");
const modal=document.getElementById("modal");
const modalBody=document.getElementById("modalBody");
const modalTitle=document.getElementById("modalTitle");
const modalClose=document.getElementById("modalClose");
modalClose.addEventListener("click", ()=>{ modalBackdrop.classList.remove("show"); modal.className="modal" });

function showInvitation({color,venue,theme}){
  modal.className="modal "+(COLOR_CLASS[color]||"");
  modalTitle.textContent="Your Secret Invitation";
  modalBody.innerHTML=`
    <span class="pill">Come together with your people.</span>
    <div class="invite-card">
      <div class="invite-brand">${color[0].toUpperCase()+color.slice(1)} Room • ${theme}</div>
      <h3 class="invite-h1">${venue?.name ?? "TBA"}</h3>
      <div class="meta">
        <div><strong>Address:</strong> ${venue?.address ?? "TBA"}</div>
        <div><strong>Starts:</strong> ${venue?.time ?? "7:30 PM"}</div>
      </div>
      <div class="buttons">
        <a class="btn" href="${venue?.maps ?? "#"}" target="_blank" rel="noopener">Directions to venue</a>
      </div>
      <div class="tiny">Show up tonight. Be seen.</div>
    </div>
  `;
  modalBackdrop.classList.add("show");
}

/* Deterministic theme & venue */
function todayStr(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}` }
function weekNumber(date=new Date()){
  const d=new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
  const dayNum=d.getUTCDay()||7; d.setUTCDate(d.getUTCDate()+4-dayNum);
  const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d-yearStart)/86400000)+1)/7);
}
function themeOfDay(){ const list=THEMES; const idx=weekNumber()%list.length; return list[idx] }
function venueFor(areaId, color){
  const list = VENUES_BY_AREA[areaId]||[]; if(!list.length) return null;
  const w=weekNumber(); const colorOffset={blue:0,green:1,red:2}[color]??0;
  const idx = (w + colorOffset) % list.length;
  return list[idx];
}

/* ===========================
   Door click handling (only matching color opens)
=========================== */
async function onDoorClick(color){
  const allowed = getArchetypeColor();         // "blue" | "green" | "red"
  const areas = getSelectedAreas();
  const areaId = areas[0] || "central-nj";
  const theme  = themeOfDay();
  const venue  = venueFor(areaId, color);

  if(color === allowed){
    await playDoorAnimation(color);            // starts immediately
    showInvitation({color, venue, theme});
  } else {
    lockedEffect(doorBtn[color]);              // quick shake feedback
  }
}
doorBtn.blue.addEventListener("click", ()=>onDoorClick("blue"));
doorBtn.green.addEventListener("click", ()=>onDoorClick("green"));
doorBtn.red.addEventListener("click", ()=>onDoorClick("red"));

/* ===========================
   Gear menu (optional)
=========================== */
const gearBtn=document.getElementById("gearBtn");
const gearMenu=document.getElementById("gearMenu");
const profileBtn=document.getElementById("profileBtn");
gearBtn.addEventListener("click",(e)=>{ e.stopPropagation(); gearMenu.classList.toggle("show") });
document.addEventListener("click",()=>gearMenu.classList.remove("show"));
profileBtn.addEventListener("click", ()=>{
  const mode=(localStorage.getItem("profileMode")||"anonymous").toLowerCase();
  if(mode==="verified"){ window.location.href="Profile-verified.html" }
  else { window.location.href="Profile-anonymous.html" }
});

/* ===========================
   Init
=========================== */
(function init(){
  // set closed frames up front
  doorImg.blue.src=DOOR_CLOSED.blue;
  doorImg.green.src=DOOR_CLOSED.green;
  doorImg.red.src=DOOR_CLOSED.red;

  // render area chips
  const selected=new Set(getSelectedAreas());
  const areasEl=document.getElementById("areas");
  areasEl.innerHTML="";
  AREAS.forEach(a=>{
    const tag=document.createElement("label");
    tag.className="tag";
    tag.innerHTML=`<input type="checkbox" id="area-${a.id}" ${selected.has(a.id)?"checked":""}> ${a.label}`;
    areasEl.appendChild(tag);
  });
})();
</script>
</body>
</html>