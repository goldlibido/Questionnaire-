<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Le Libido – Secret Invite</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --gold:#e1bf78;
    --black:#000;
    --white:#fff;
    --blue:#2CA0FF;   /* caption color */
    --green:#20C071;  /* caption color */
    --red:#FF3B30;    /* caption color */
    --door-blue:#064D95;
    --door-green:#06954E;
    --door-red:#950606;
    --modal-max:560px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--black);color:var(--white);
    font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
  }
  .wrap{min-height:100svh;padding:18px 16px 28px;border:2px solid var(--gold)}

  /* Doors layout */
  .doors{
    display:grid;gap:34px;max-width:680px;margin:0 auto;
  }
  @media(min-width:900px){
    .doors{grid-template-columns:repeat(3,minmax(0,1fr));max-width:1100px}
  }

  .door{display:flex;flex-direction:column;align-items:center}
  .door-top{font-weight:700;margin:0 0 8px 0;letter-spacing:.2px;font-size:18px}
  .top-blue{color:var(--blue)}
  .top-green{color:var(--green)}
  .top-red{color:var(--red)}

  /* Button holds only the image, no gray card behind it */
  .door-btn{
    display:block;width:86%;max-width:380px;aspect-ratio:3/5;
    background:transparent;border:none;outline:none;padding:0;cursor:pointer;
  }
  .door-btn img{width:100%;height:100%;object-fit:contain;background:transparent;display:block}

  .door-btm{
    text-align:center;margin-top:8px;line-height:1.15;
  }
  .door-name{font-size:20px;font-weight:700;margin:0 0 4px 0}
  .door-hint{font-size:13px;color:#cfcfcf;margin:0}

  /* Shake when locked */
  .shake{animation:shake .45s ease}
  @keyframes shake{
    10%,90%{transform:translateX(-1px)}
    20%,80%{transform:translateX(2px)}
    30%,50%,70%{transform:translateX(-4px)}
    40%,60%{transform:translateX(4px)}
  }

  /* Modal */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:20px;z-index:50}
  .modal-backdrop.show{display:flex}
  .modal{width:100%;max-width:var(--modal-max);background:#0f0f0f;border:2px solid var(--gold);border-radius:16px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.6)}
  .modal-head{padding:14px 18px;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between}
  .modal-title{margin:0;font-size:20px;font-weight:800;letter-spacing:.2px;color:var(--gold)}
  .modal-close{background:transparent;border:none;color:var(--white);font-size:24px;cursor:pointer;line-height:1}
  .modal-body{padding:18px}
  .pill{display:inline-block;border:1px solid var(--gold);color:var(--gold);padding:6px 10px;border-radius:999px;font-size:12px;margin-bottom:10px}
  .invite-card{border:1px solid var(--gold);border-radius:12px;padding:16px;margin-top:10px;background:#111}
  .invite-brand{font-size:14px;opacity:.9;margin-bottom:8px}
  .invite-h1{margin:0 0 10px 0;font-size:22px;font-weight:800;line-height:1.25}
  .meta{display:grid;grid-template-columns:1fr;gap:8px;margin:12px 0}
  .meta div{font-size:14px;opacity:.95}
  .buttons{display:flex;flex-direction:column;gap:10px;margin-top:12px}
  .btn{border:1px solid var(--gold);background:transparent;color:var(--gold);padding:12px;border-radius:10px;cursor:pointer;font-weight:700;text-align:center}
  .btn.primary{background:var(--gold);color:#111;border-color:var(--gold)}
  .btn:disabled{opacity:.45;cursor:not-allowed}
  .tiny{font-size:12px;opacity:.8;margin-top:6px}

  /* Theme tints */
  .theme-red .invite-card{background:rgba(149,6,6,.12)}
  .theme-green .invite-card{background:rgba(6,149,78,.12)}
  .theme-blue .invite-card{background:rgba(6,77,149,.12)}

  .blurred{filter:blur(6px);user-select:none}
</style>
</head>
<body>
<div class="wrap">
  <section class="doors">
    <!-- BLUE -->
    <div class="door" data-color="blue">
      <p class="door-top top-blue">For the Romantic</p>
      <button class="door-btn" id="door-blue" aria-label="Blue room door">
        <img id="door-blue-img" alt="Blue door" src="" />
      </button>
      <div class="door-btm">
        <p class="door-name">Blue Room</p>
        <p class="door-hint">Click door to enter the Blue room</p>
      </div>
    </div>

    <!-- GREEN -->
    <div class="door" data-color="green">
      <p class="door-top top-green">For the Frisky</p>
      <button class="door-btn" id="door-green" aria-label="Green room door">
        <img id="door-green-img" alt="Green door" src="" />
      </button>
      <div class="door-btm">
        <p class="door-name">Green Room</p>
        <p class="door-hint">Click door to enter the Green room</p>
      </div>
    </div>

    <!-- RED -->
    <div class="door" data-color="red">
      <p class="door-top top-red">For the Kinky</p>
      <button class="door-btn" id="door-red" aria-label="Red room door">
        <img id="door-red-img" alt="Red door" src="" />
      </button>
      <div class="door-btm">
        <p class="door-name">Red Room</p>
        <p class="door-hint">Click door to enter the Red room</p>
      </div>
    </div>
  </section>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
  <div class="modal" id="modal">
    <div class="modal-head">
      <h2 class="modal-title" id="modalTitle">Invitation</h2>
      <button class="modal-close" id="modalClose" aria-label="Close">×</button>
    </div>
    <div class="modal-body" id="modalBody"></div>
  </div>
</div>

<script>
/* =======================
   UTIL + DATA
======================= */
function todayStr(){const d=new Date();return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`}
function weekNumber(date=new Date()){const d=new Date(Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()));const day=d.getUTCDay()||7;d.setUTCDate(d.getUTCDate()+4-day);const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1));return Math.ceil((((d-yearStart)/86400000)+1)/7)}
function hashCode(str){let h=0;for(let i=0;i<str.length;i++){h=((h<<5)-h)+str.charCodeAt(i);h|=0}return Math.abs(h)}
const THEMES=["Heaven vs. Hell: Angel or Devil","Cats vs. Dogs","Brain vs. Brawn","Light vs. Dark","Burlesque & Cabaret","Fetish Fantasy","Sexy Uniform","Slumber Party Gone Wild","Primal Instincts","Neon Nights","Mobster & Mob Wife","Goth night","After Dark at the Office","Flasher","Vampires and Velvet"];
function themeOfDay(){return THEMES[hashCode(todayStr())%THEMES.length]}

const VENUES_BY_AREA={
  "central-nj":[
    {name:"Metropolitan Cafe",address:"8 E Main St, Freehold, NJ 07728",time:"7:30 PM",maps:"https://www.google.com/maps/search/?api=1&query=Metropolitan+Cafe+8+E+Main+St,+Freehold,+NJ+07728"},
    {name:"Nonna’s Cucina",address:"448 US-9, Englishtown, NJ 07726",time:"7:30 PM",maps:"https://www.google.com/maps/search/?api=1&query=Nonna%E2%80%99s+Cucina+448+US-9,+Englishtown,+NJ+07726"}
  ]
};
function venueFor(areaId,color){
  const list=VENUES_BY_AREA[areaId]||[]; if(!list.length) return null;
  const dow=new Date().getDay(); const w=weekNumber(); const colorOffset={blue:0,green:1,red:2}[color]||0;
  const idx=(w + dow + colorOffset) % list.length; return list[idx];
}
function getArchetypeColor(){const c=(localStorage.getItem("archetypeColor")||"").toLowerCase();return ["red","green","blue"].includes(c)?c:null}
function track(e,p={}){console.log("[analytics]",e,p)}

/* Door frame images */
const DOOR_FRAMES={
  blue:Array.from({length:7},(_,i)=>`door/blue-door-${i+1}.png`),
  green:Array.from({length:7},(_,i)=>`door/green-door-${i+1}.png`),
  red:Array.from({length:7},(_,i)=>`door/red-door-${i+1}.png`)
};
const DOOR_CLOSED={blue:DOOR_FRAMES.blue[0],green:DOOR_FRAMES.green[0],red:DOOR_FRAMES.red[0]};
const FRAME_DUR=150; // ms per frame (≈0.15s)

/* Preload frames */
["blue","green","red"].forEach(c=>DOOR_FRAMES[c].forEach(src=>{const i=new Image();i.src=src;}));

/* =======================
   INITIALIZE DOORS
======================= */
const img={blue:document.getElementById("door-blue-img"),green:document.getElementById("door-green-img"),red:document.getElementById("door-red-img")};
const btn={blue:document.getElementById("door-blue"),green:document.getElementById("door-green"),red:document.getElementById("door-red")};
img.blue.src=DOOR_CLOSED.blue; img.green.src=DOOR_CLOSED.green; img.red.src=DOOR_CLOSED.red;

/* Smooth frame animation */
function playDoorAnimation(color){
  const frames=DOOR_FRAMES[color]; const target=img[color];
  return new Promise(resolve=>{
    let i=0;
    const step=()=>{
      target.src=frames[i++];
      if(i<frames.length){ setTimeout(step, FRAME_DUR); }
      else { resolve(); }
    };
    step();
  });
}

/* Shake + haptic */
function lockedEffect(button){
  button.classList.remove("shake"); void button.offsetWidth; button.classList.add("shake");
  if(navigator.vibrate){ try{ navigator.vibrate(100); }catch(e){} }
}

/* =======================
   MODAL
======================= */
const modalBackdrop=document.getElementById("modalBackdrop");
const modal=document.getElementById("modal");
const modalBody=document.getElementById("modalBody");
const modalTitle=document.getElementById("modalTitle");
const modalClose=document.getElementById("modalClose");
function closeModal(){ modalBackdrop.classList.remove("show"); modal.classList.remove("theme-red","theme-green","theme-blue"); modalBody.innerHTML=""; }
modalClose.addEventListener("click", closeModal);
modalBackdrop.addEventListener("click", e=>{ if(e.target===modalBackdrop) closeModal() });

function fmtICSDate(d){return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}T${String(d.getHours()).padStart(2,'0')}${String(d.getMinutes()).padStart(2,'0')}00`}
function addToCalendar({title,location,startDateTime,endDateTime,description=""}){
  const lines=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Le Libido//Pop-Up//EN","BEGIN:VEVENT",`UID:${crypto.randomUUID()}@lelibido.com`,`DTSTAMP:${todayStr().replace(/-/g,"")}T000000`,`DTSTART:${startDateTime}`,`DTEND:${endDateTime}`,`SUMMARY:${title}`,`LOCATION:${location}`,`DESCRIPTION:${description.replace(/\n/g,"\\n")}`,"END:VEVENT","END:VCALENDAR"];
  const blob=new Blob([lines.join("\r\n")],{type:"text/calendar;charset=utf-8"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=`${title.replace(/\s+/g,"_")}.ics`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

async function showInvitation({color,venue,theme}){
  modal.classList.remove("theme-red","theme-green","theme-blue");
  modal.classList.add({red:"theme-red",green:"theme-green",blue:"theme-blue"}[color]||"");
  modalTitle.textContent="Invitation";

  const now=new Date();
  const start=new Date(now.getFullYear(),now.getMonth(),now.getDate(),19,30,0);
  const end=new Date(now.getFullYear(),now.getMonth(),now.getDate(),21,30,0);

  modalBody.innerHTML=`
    <span class="pill">Come together with your people.</span>
    <div class="invite-card">
      <div class="invite-brand">${color[0].toUpperCase()+color.slice(1)} Room • ${theme}</div>
      <h3 class="invite-h1">${venue?.name ?? "TBA"}</h3>
      <div class="meta">
        <div><strong>Address:</strong> ${venue?.address ?? "TBA"}</div>
        <div><strong>Starts:</strong> ${venue?.time ?? "7:30 PM"}</div>
      </div>
      <div class="buttons">
        <a class="btn" href="${venue?.maps ?? "#"}" target="_blank" rel="noopener">Directions to venue</a>
        <button class="btn primary" id="addToCalBtn">Add to calendar</button>
      </div>
    </div>
  `;
  modalBackdrop.classList.add("show");

  modalBody.querySelector("#addToCalBtn").addEventListener("click", ()=>{
    addToCalendar({
      title:`Le Libido: ${venue?.name ?? "Pop-Up"}`,
      location:venue?.address ?? "",
      startDateTime:fmtICSDate(start),
      endDateTime:fmtICSDate(end),
      description:`${theme}\nRoom: ${color.toUpperCase()}`
    });
    track("add_to_calendar",{color,venue:venue?.name});
  });
}

function showLocked({color,venue,theme}){
  modal.classList.remove("theme-red","theme-green","theme-blue");
  modal.classList.add({red:"theme-red",green:"theme-green",blue:"theme-blue"}[color]||"");
  modalTitle.textContent="Want to Come?";

  modalBody.innerHTML=`
    <div class="invite-card">
      <div class="invite-brand">${color[0].toUpperCase()+color.slice(1)} Room • <span class="blurred">${theme}</span></div>
      <h3 class="invite-h1 blurred">${venue?.name ?? "Secret Venue"}</h3>
      <div class="meta">
        <div class="blurred"><strong>Address:</strong> ${venue?.address ?? "Hidden for now"}</div>
        <div class="blurred"><strong>Starts:</strong> ${venue?.time ?? "7:30 PM"}</div>
      </div>
      <div class="buttons">
        <a class="btn" href="/checkout/single.html?date=${encodeURIComponent(todayStr())}&color=${encodeURIComponent(color)}">Gain access to the ${color} room tonight for only $2</a>
        <a class="btn primary" href="/checkout/all-today.html?date=${encodeURIComponent(todayStr())}">Gain access to every room tonight for only $3</a>
      </div>
      <div class="tiny">Access is for today only.</div>
    </div>
  `;
  modalBackdrop.classList.add("show");
}

/* =======================
   CLICK LOGIC
======================= */
async function onDoorClick(color){
  const userColor=getArchetypeColor();            // "red" | "green" | "blue"
  const areaId="central-nj";                       // simple default
  const venue=venueFor(areaId,color);
  const theme=themeOfDay();

  if(userColor && userColor===color){
    track("door_open_click",{color,date:todayStr()});
    await playDoorAnimation(color);                // << play animation, then modal
    showInvitation({color,venue,theme});
  }else{
    track("door_locked_click",{color,date:todayStr()});
    lockedEffect(btn[color]);
    setTimeout(()=>showLocked({color,venue,theme}), 220);
  }
}

btn.blue.addEventListener("click", ()=>onDoorClick("blue"));
btn.green.addEventListener("click", ()=>onDoorClick("green"));
btn.red.addEventListener("click", ()=>onDoorClick("red"));

/* =======================
   START
======================= */
track("page_view",{page:"secret-invite"});
</script>
</body>
</html>